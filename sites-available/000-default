# -*-mode: nginx; mode: flyspell-prog;  ispell-local-dictionary: "american" -*-
### Block all illegal host headers. Taken from a discussion on nginx
### forums. Cf. http://forum.nginx.org/read.php?2,3482,3518 following
### a suggestion by Maxim Dounin. Also suggested in
### http://nginx.org/en/docs/http/request_processing.html#how_to_prevent_undefined_server_names.
server {
    listen [::]:80 default ipv6only=on; # listen for IPv6 only traffic on IPv6 sockets
    listen 80; # listen also for IPv4 traffic on "regular" IPv4 sockets

    # Accept redirects based on the value of the Host header. If
    # there's no valid vhost configuration file with a
    # corresponding server_name directive then signal an error and
    # fail silently. See:
    # http://wiki.nginx.org/NginxHttpCoreModule#server_name_in_redirect
    server_name_in_redirect off;
    return 444;
}
